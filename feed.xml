<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.0.0">Jekyll</generator><link href="https://gunnhildsp.github.io/notes/feed.xml" rel="self" type="application/atom+xml" /><link href="https://gunnhildsp.github.io/notes/" rel="alternate" type="text/html" /><updated>2020-03-14T17:44:28-05:00</updated><id>https://gunnhildsp.github.io/notes/feed.xml</id><title type="html">Gunnhild’s notes</title><subtitle>Learning by writing things down</subtitle><entry><title type="html">An Example Markdown Post</title><link href="https://gunnhildsp.github.io/notes/markdown/2020/03/14/metrics.html" rel="alternate" type="text/html" title="An Example Markdown Post" /><published>2020-03-14T00:00:00-05:00</published><updated>2020-03-14T00:00:00-05:00</updated><id>https://gunnhildsp.github.io/notes/markdown/2020/03/14/metrics</id><content type="html" xml:base="https://gunnhildsp.github.io/notes/markdown/2020/03/14/metrics.html">&lt;h1 id=&quot;example-markdown-post&quot;&gt;Example Markdown Post&lt;/h1&gt;
&lt;p&gt;Test setup&lt;/p&gt;
&lt;h2 id=&quot;basic-setup&quot;&gt;Basic setup&lt;/h2&gt;
&lt;p&gt;Testing the setup&lt;/p&gt;</content><author><name></name></author><summary type="html">Example Markdown Post Test setup Basic setup Testing the setup</summary></entry><entry><title type="html">Challenges with simple metrics in machine learning</title><link href="https://gunnhildsp.github.io/notes/metrics/data-science/2020/03/07/metrics.html" rel="alternate" type="text/html" title="Challenges with simple metrics in machine learning" /><published>2020-03-07T00:00:00-06:00</published><updated>2020-03-07T00:00:00-06:00</updated><id>https://gunnhildsp.github.io/notes/metrics/data-science/2020/03/07/metrics</id><content type="html" xml:base="https://gunnhildsp.github.io/notes/metrics/data-science/2020/03/07/metrics.html">&lt;h1 id=&quot;the-challenge-with-simple-evaluation-metrics-in-machine-learning&quot;&gt;The challenge with simple evaluation metrics in machine learning&lt;/h1&gt;

&lt;p&gt;Picking a metric for your problem implies defining success. This makes it important to know different metrics, their shortcomings and possible mediating actions when metrics are not sufficient. There has been many interesting pieces on this topic lately. My sources for this post are:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;http://lineardigressions.com/episodes/2019/12/22/data-scientists-beware-of-simple-metrics&quot;&gt;Data scientists: beware of simple metrics&lt;/a&gt;: Episode of the podcast &lt;a href=&quot;http://lineardigressions.com/&quot;&gt;Linear Digressions&lt;/a&gt; that provides a gentle introduction to the topic, and was my source for the articles below.&lt;/li&gt;
  &lt;li&gt;&lt;a id=&quot;1&quot;&gt;[1]&lt;/a&gt;: &lt;a href=&quot;https://arxiv.org/ftp/arxiv/papers/2002/2002.08512.pdf&quot;&gt;Reliance on Metrics is a Fundamental Challenge for AI&lt;/a&gt;: Reviews of different case studies showing how emphasis on metrics can lead to manipulation, gaming of scores and focus on short-term goals and how to adress the issues.&lt;/li&gt;
  &lt;li&gt;&lt;a id=&quot;2&quot;&gt;[2]&lt;/a&gt;: &lt;a href=&quot;https://arxiv.org/pdf/1909.12475.pdf&quot;&gt;Hidden Stratification Causes Clinically Meaningful Failures in Machine Learning for Medical Imaging&lt;/a&gt;: Introduces a concept reminding me of &lt;a href=&quot;https://en.wikipedia.org/wiki/Simpson%27s_paradox&quot;&gt;Simpson’s paradox&lt;/a&gt;, where a model outperforms humans (or another model) in the average, but underperforms for a given subset, which may be critical for the outcome of using the model.&lt;/li&gt;
  &lt;li&gt;&lt;a id=&quot;3&quot;&gt;[3]&lt;/a&gt;: &lt;a href=&quot;https://medium.com/shoprunner/evaluating-classification-models-1-ff0730801f17&quot;&gt;Evaluating classification models&lt;/a&gt;: This four part Medium series highlights classification model metrics, arguing for a single evaluation metric, but gives examples of different use cases for preferring different metrics.&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;the-problem&quot;&gt;The problem&lt;/h1&gt;
&lt;h2 id=&quot;metrics-in-machine-learning&quot;&gt;Metrics in machine learning&lt;/h2&gt;
&lt;p&gt;Most AI algorithms are based on optimizing metrics, and due to algorithms optimizing blindly, and &lt;em&gt;too efficiently&lt;/em&gt;, a model that scores better on metrics may often lead to outcomes that are far from optimal. The paper cites &lt;em&gt;Goodhart’s law&lt;/em&gt;:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;When a measure becomes a target, it ceases to be a good measure.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Goodhart’s law arose in the 1970s after attemps to slow down inflation, by choosing metrics with stable relationships to inflation as targets for central banks. However, the relationships between the chosen metrics and inflation broke down when the metrics were chosen as targets. The law arose from observing human behaviour, but an algorthim will optimize more efficiently as is therefore more prone to following this law.&lt;/p&gt;

&lt;p&gt;As training a model is explicitly defined around optimizing a specific metric, such as accuracy or error rate, we knowingly or unknowingly make priotizations in our problem, such as&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;whether or not we can give partial credit for some answers&lt;/li&gt;
  &lt;li&gt;whether or not false positives are equally weighted as false negatives&lt;/li&gt;
  &lt;li&gt;whether or not we penalize frequent medium errors the same as rare large errors&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;four-problems-with-metrics&quot;&gt;Four problems with metrics&lt;/h2&gt;
&lt;p&gt;The problems found by case study review in &lt;a href=&quot;#1&quot;&gt;[1]&lt;/a&gt; are:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Metrics are proxies
    &lt;ul&gt;
      &lt;li&gt;They may be invalid in corner cases, extreme cases or represent a non-causal relationship, for example: When we want to assess crime, we measure arrests.&lt;/li&gt;
      &lt;li&gt;We don’t always realize that we are measuring a proxy, i.e. that our dataset does not contain features that are actually correlated with the goal. An example given was a study to investigate stroke patients, that ended up finding patients who were able to use the health care services.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Metrics will be gamed, not only in model selection but by models themselves.
    &lt;ul&gt;
      &lt;li&gt;In reinforcement learning, two types of gaming are &lt;a href=&quot;https://docs.google.com/spreadsheets/d/e/2PACX-1vRPiprOaC3HsCf5Tuum8bRfzYUiKLRqJmbOoC-32JorNdfyTiRRsR7Ea5eWtvsWzuxo8bjOxCG84dAg/pubhtml&quot;&gt;common&lt;/a&gt;:
        &lt;ul&gt;
          &lt;li&gt;gaming metrics: exploiting a poor definition of metrics&lt;/li&gt;
          &lt;li&gt;finding glithces in implementations of environment or reward function&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;Recommender algorithms are also prone to be gamed as adversarial attacks&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Metrics over-emphasize short-term goals
    &lt;ul&gt;
      &lt;li&gt;A common example is the click-through rate which does not tell us anything about long term effects on readers’ behaviour&lt;/li&gt;
      &lt;li&gt;YouTube &amp;amp; Facebook both have examples of promoting horrible content, which eventually damages hiring abilities for the companies&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Many online metrics are gathered in highly addictive environments&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;hidden-stratification&quot;&gt;Hidden stratification&lt;/h2&gt;
&lt;p&gt;Another problem described in &lt;a href=&quot;#2&quot;&gt;[2]&lt;/a&gt; as hidden stratification manifests as a model outperforming humans in the aggregate, but underperforming in a critical segment, i.e. there are hidden subsets of the data where performance is poor. Many metrics will not reveal this, as they are dominated by larger subsets.&lt;/p&gt;

&lt;p&gt;Hidden stratification is particularly important in medical research, and other fields where the cost of false negatives can be far higher than the cost of false positives (or vice versa). An example is a model that on average outperforms human in classifying scans as cancerous or healthy, but underperforms for the most aggressive cancer types. If the task was allocated to the model alone, this could in fact lead to higher mortality.&lt;/p&gt;

&lt;p&gt;Whether or not hidden stratification poses a problem is identified through the dataset, likely progression of events and consequences:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;imbalanced classes, where the most serious events happen rarely&lt;/li&gt;
  &lt;li&gt;rapidly developing complications&lt;/li&gt;
  &lt;li&gt;imbalance in consequences, where consequences of one class is far more serious than other classes.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Different structures of subclasses contribute to degraded performance:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Low subclass prevalence&lt;/li&gt;
  &lt;li&gt;Reduced accuracy of labels in the subclass&lt;/li&gt;
  &lt;li&gt;Subtle discriminative features&lt;/li&gt;
  &lt;li&gt;Spurious correlations&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;proposed-solutions-and-mitigating-measures&quot;&gt;Proposed solutions and mitigating measures&lt;/h1&gt;
&lt;h2 id=&quot;three-solutions-to-adress-weaknesses-of-metrics&quot;&gt;Three solutions to adress weaknesses of metrics&lt;/h2&gt;
&lt;p&gt;Solutions proposed in &lt;a href=&quot;#1&quot;&gt;[1]&lt;/a&gt; are:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Use several different metrics&lt;/strong&gt;, to prevent gaming and to obtain a more robust basis for evaluation, for example by using
    &lt;ul&gt;
      &lt;li&gt;Metrics measuring different proxies of the same goal&lt;/li&gt;
      &lt;li&gt;Metrics measuring the same proxy for different time horizons&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Combine metrics with qualitative accounts&lt;/strong&gt;. Two concrete suggestions for accounts accompanying metrics are
    &lt;ul&gt;
      &lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://arxiv.org/pdf/1810.03993.pdf&quot;&gt;Model cards for model reporting&lt;/a&gt;&lt;/strong&gt; are fact sheets containing additional information on trained models, aimed to reduce unintended side effects of using models wrongly. The cards are intended for model developers, software developers, impacted individuals, policy makers etc. containing descriptions of (among other details):
        &lt;ul&gt;
          &lt;li&gt;Indented use, intended users and out-of-scope use cases&lt;/li&gt;
          &lt;li&gt;Metrics, decision thresholds and how uncertainty in metrics has been assessed&lt;/li&gt;
          &lt;li&gt;Details on the evaluation dataset and training dataset if possible: description, preprocessing, motivation behind chosen datasets&lt;/li&gt;
          &lt;li&gt;Factors: groups of observations in dataset, instrumentation of observations, environment where data has been collected&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://arxiv.org/pdf/1803.09010.pdf&quot;&gt;Datasheets for datasets&lt;/a&gt;&lt;/strong&gt; are fact sheets to facilitate communication between dataset creators and dataset consumers answering questions within the topics
        &lt;ul&gt;
          &lt;li&gt;Motivation (what problem prompted the creation, who created it, with support from whom)&lt;/li&gt;
          &lt;li&gt;Composition (Is it a sample or a complete set, labels, missing information, recommended split, error sources, is it self contained)&lt;/li&gt;
          &lt;li&gt;Collection process (directly observed/self reported/inferred, time frame for collection, sampling strategy if any)&lt;/li&gt;
          &lt;li&gt;Preprocessing (discretization, binning, removal of observations, processing of missing values, link to raw data, link to software for data cleaning)&lt;/li&gt;
          &lt;li&gt;Uses (Tasks the dataset is currently or previously used for, potential other tasks, potential impact to future uses from creation process of the dataset)&lt;/li&gt;
          &lt;li&gt;Distribution (Availability and sensitivity of dataset)&lt;/li&gt;
          &lt;li&gt;Maintenance (Who is responsible, will the dataset be updated, erratum, availability of older versions, procedures if users want to extend the dataset)&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Involve different stakeholders in the initial metric development&lt;/strong&gt;. &lt;em&gt;Model cards&lt;/em&gt; suggests involving stakeholders by teaching the implications of an already existing model, but &lt;a href=&quot;#1&quot;&gt;[1]&lt;/a&gt; suggests even involving stakeholders in development of metrics.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;measuring-hidden-stratifications-so-it-can-be-addressed&quot;&gt;Measuring hidden stratifications so it can be addressed&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;#2&quot;&gt;[2]&lt;/a&gt; proposes three strategies for measuring hidden stratifications, which then need to be addressed by models in different ways.&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Schema completion&lt;/strong&gt;: A schema author defines all subsets that need to be labeled, and performs labeling on the test dataset.
    &lt;ul&gt;
      &lt;li&gt;Enables accurate reporting&lt;/li&gt;
      &lt;li&gt;Helps guide model development&lt;/li&gt;
      &lt;li&gt;Time consuming&lt;/li&gt;
      &lt;li&gt;Limited by the knowledge of the schema author&lt;/li&gt;
    &lt;/ul&gt;

    &lt;p&gt;Experiments showed substantial differences in AUC score for different subsets identified by a medical professional, for a dataset exhibiting low subclass prevalence and subtle discriminative features as well as one exhibiting poor label quality and subtle discriminative features.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Error auditing&lt;/strong&gt;: An auditor examines model output in search of irregularities such as consistently incorrect predictions on a recognizable subclass.
    &lt;ul&gt;
      &lt;li&gt;Not limited by the expectations of a schema author&lt;/li&gt;
      &lt;li&gt;Only concerning subclasses need to be examined, thus more labor-efficient than schema completion&lt;/li&gt;
      &lt;li&gt;Limited by the weaknesses identified by the auditor, therefore not as exhaustive a search as the schema completion&lt;/li&gt;
      &lt;li&gt;Limited by errors prevalent in the test set, may not be representative for small subsets&lt;/li&gt;
    &lt;/ul&gt;

    &lt;p&gt;The method was tested on a dataset with spurious correlations. A particular subset was found to be prevalent in the test set false negatives, and labeled each observation in the test set accordingly. The spurious correlation factor in the poorly performing subset, was found to have a corresponding superset without the spurious correlation factor with high AUC scores.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Algorithmic measurement&lt;/strong&gt;: An algorithmic search for for subclasses, such as clustering.
    &lt;ul&gt;
      &lt;li&gt;Less dependent on a human identifying all relevant subsets&lt;/li&gt;
      &lt;li&gt;Can reduce burden on a human analyst&lt;/li&gt;
      &lt;li&gt;Efficiency is limited by the difficulty of separating subclasses in the feature space of the analysis&lt;/li&gt;
      &lt;li&gt;Still requires human review&lt;/li&gt;
    &lt;/ul&gt;

    &lt;p&gt;Concretely, a simple k-means algorithm was applied for k from 2 - 5. For each k, the two clusters (with more than 100 observations) with the largest difference in error rate was identified. From these four pairs, the one with the largest Euclidian distance between centres is chosen. The method is not always successful in producing well-separated clusters for clinically meaningful subclasses, but may be useful with improved clustering algorithms, or in addition to one of the other methods.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;combining-metrics-to-a-single-evaluation-metric&quot;&gt;Combining metrics to a single evaluation metric&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;#3&quot;&gt;[3]&lt;/a&gt; seemingly opposes &lt;a href=&quot;#1&quot;&gt;[1]&lt;/a&gt; and &lt;a href=&quot;#2&quot;&gt;[2]&lt;/a&gt; and recommends that we decide on one single metric in order to be able to iterate quickly and develop and rank new models, and argues that using a slate of different metrics is more suited for model diagnostics than evaluation. This approach is also &lt;a href=&quot;https://www.coursera.org/lecture/machine-learning-projects/single-number-evaluation-metric-wIKkC&quot;&gt;recommended by the famous Andrew Ng&lt;/a&gt; for model development.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;#3&quot;&gt;[3]&lt;/a&gt; discusses metrics for classification models, where we measure false positives and false negatives, bringing us to precision and recall, precision being the fraction of positive predictions that are correct, and recall being the fraction of predictions on the positive class that are correct. Two different models are examined, one with better precision, and one with better recall. When choosing between the two, we choose how much better precision or recall we want to get, by sacrificing the other.&lt;/p&gt;

&lt;p&gt;To get to a single metric, the article proposes different combinations of precision P and recall R:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Linear relationships
    &lt;ul&gt;
      &lt;li&gt;&lt;strong&gt;Weighted arithmetic mean&lt;/strong&gt;: A simple arithmetic mean is just 0.5P + 0.5R. We would weight precision and recall equally, always being willing to trade one unit of precision for one unit of recall. We could weight precision and recall differently, for example by saying we will trade one unit of precision for &lt;em&gt;a&lt;/em&gt; units of recall, indicating for &lt;em&gt;a &amp;gt; 0&lt;/em&gt; that we care more about precision than recall. This represents a &lt;strong&gt;linear relationship&lt;/strong&gt; between the trade-off. If &lt;em&gt;a = 2&lt;/em&gt;, a model with a precision of 80 % and recall of 40 % is equally good as a model with precision of 70 % and recall of 60 %.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Non-linear relationships&lt;/p&gt;

    &lt;p&gt;The article proposes several different non-linear combinations:&lt;/p&gt;
    &lt;ul&gt;
      &lt;li&gt;&lt;strong&gt;Weighted harmonic mean&lt;/strong&gt;&lt;/li&gt;
      &lt;li&gt;&lt;strong&gt;Weighted geometric mean&lt;/strong&gt;&lt;/li&gt;
      &lt;li&gt;&lt;strong&gt;Weighted power mean&lt;/strong&gt;&lt;/li&gt;
    &lt;/ul&gt;

    &lt;p&gt;With a non-linear relationship, the relative importance of precision and recall depend on their current values. When recall is low, recall is valued higher than precision and vice versa.
A geometric mean is closer to the linear relationship than the harmonic mean. Whereas the geometric and harmonic mean, had constant preference lines that curved upwards for all parameter values, the power means are more flexible, and curvature of the constant preference lines shift from curving upwards to downwards as we vary parameters.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The author argues that whether or not arithmetic means are sufficient depends on the nature of the problem. In clinical situations, arithmetic means are often sufficient. Each individual experiences one single prediction from the model. The author works in retail, where the rate of false positive to false negative classifications is valued differently based on the level of false positives, and each individual experiences a range of predictions from the model. As the author puts it, it is not each single prediction that matters, but the &lt;em&gt;overall impression&lt;/em&gt;, as is typical for information retrieval problems. For example, at a high recall (we are classifying most dresses as dresses), another point of recall isn’t that important, because a customer will find the dress they are looking for, and it is more important to improve precision, such that there are fewer false positives. Equivalenty, if precision is very high, it is probably more important to work on the recall, making sure the customer can be exposed to all dresses, rather than making sure that the customer is not exposed to something which is not a dress.&lt;/p&gt;

&lt;h1 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h1&gt;
&lt;p&gt;It seems that everyone has a favorite urban legend of how a metric was gamed or lead to unforseen consequences, be it from human experience or a reinforcement learning agent. The three articles seem to assess the situation differently:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#1&quot;&gt;[1]&lt;/a&gt; proposes different ways to enrich simple metrics: using several metrics, using qualitative accounts in addition, and letting stakeholders take part in defining metrics. Spending more time defining and reviewing effects of metrics with stakeholders it probably time well spent, although iteration cycles for models will be longer with a slate of metrics. Although I like the idea of explicitly stating the intended purpose and out-of-scope use cases for a model, I wonder how it should be implemented in order to keep it updated and helpful for relevant end users.&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#2&quot;&gt;[2]&lt;/a&gt; does not directly propose a solution, but exposes a problem and the settings in which we should investigate whether our models have hidden stratifications that may worsen end outcomes although performance metrics show improvements. Although these problems do not always lead to fatal outcomes, investigating models to find subdomains of poor performance is a good practice to improve models, and should be practiced systematically.&lt;/li&gt;
  &lt;li&gt;Whereas &lt;a href=&quot;#1&quot;&gt;[1]&lt;/a&gt; and &lt;a href=&quot;#2&quot;&gt;[2]&lt;/a&gt; show weaknesses of single metric evaluation, &lt;a href=&quot;#3&quot;&gt;[3]&lt;/a&gt; argues for the benefits to model development iteration cycles. I find this very compelling. Although I haven’t used the particular metrics described in the series in practice, the concept of experimenting with finding and reviewing which metric is used seems to mediate some of the shortcomings of single metrics. Using several metrics lead us to implicitly weighing them against eachother, whereas combining metrics to a single number leads to an explicit definition, which again leads to concrete and transparent examples which we can discuss with stakeholders.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;It seems to me that a single metric for evaluation can be a recipe for disaster or success, depending on the execution, transparency and willingness to adjust. If done correctly, I think it leverages some of the benefits found in the metrics article, while still obtaining a simple way to evaluate experiments and quickly develop and test new hypotheses. If done poorly, it is just another metric that can be gamed.&lt;/p&gt;</content><author><name></name></author><summary type="html">The challenge with simple evaluation metrics in machine learning</summary></entry></feed>